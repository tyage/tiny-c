# 課題 7

課題 6 の Tiny C コンパイラ（構文木表示プログラム）の意味解析部を実装せよ．

- 本節で述べた意味解析の他に，関数呼出時の引数の数のチェックも行なうようにせよ．
- パラメータの置かれる相対番地を求めるようにせよ．
- 教科書 6.3 節及び 6.4.1 節の方法を用いて局所変数の置かれる相対番地を求めるようにせよ. 相対番地の計算は，構文解析のアクション部ではなく，構文木表示部で行なうべきである．
   - [注意] 局所変数の格納領域には，レジスタの値を一時的に退避しておくための一時変数も割り当てられるため，局所変数の格納場所は一般にはコード生成の段階で決まる．（パラメータの相対番地については，構文解析時に求めればよい．）
- 構文木表示プログラムにおいて，大域変数宣言，関数定義，パラメータ宣言，局所変数宣言，変数参照において各識別子を表示する際に，それぞれのブロックレベルを表示するようにせよ．
- さらに，パラメータ宣言と局所変数宣言の表示の際にそれぞれの相対番地を表示するようにせよ．

パース終了時の表示ルーチンを呼び出す部分は，次のように変更すればよい．
意味解析におけるエラーが一つ以上見つかった場合も，表示ルーチンは呼び出されない．

```
main:
    { symtab = NULL; cur_lev = 0; }
  program
    { if (yynerrs == 0 && semnerrs == 0)
      print_program($2); }
  ;
```

## 実行例:

```sh
% cat test.c
int x;
int f(int x, int y)
{
  int x;
  {
    int x, y;
    x+y;
    {
      int x, z;
      x+y+z;
    }
  }
  {
    int w;
    x+y+w;
  }
  x+y;
}
int g(int y)
{
  int z;
  f(x, y);
  g(z);
}
% ./tcc < test.c
4: warning: declaration of ‘x’ shadows a parameter
6: warning: declaration of ‘y’ shadows a parameter
(int x:0)
((int f:0) ((int x:1:8)(int y:1:12))
(
  (int x:2:-4)
  (
    (int x:3:-8 y:3:-12)
    (+ x:3 y:3)
    (
      (int x:4:-16 z:4:-20)
      (+ (+ x:4 y:3) z:4)
    )
  )
  (
    (int w:3:-8)
    (+ (+ x:2 y:1) w:3)
  )
  (+ x:2 y:1)
))
((int g:0) ((int y:1:8))
(
  (int z:2:-4)
  (FCALL f:0 x:0 y:1)
  (FCALL g:0 z:2)
))
```

[注意] 課題 6 と同様，インデントや改行などの工夫は必須ではない．
